<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PENGURUSAN RMT SKKN</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; margin: 0; }
        .canvas-header { background-color: #002d5b; border-bottom: 5px solid #ff7a00; }
        .stat-card { background: white; border-radius: 24px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); }
        .card-accent-blue { border-left: 6px solid #3b82f6; }
        .card-accent-orange { border-left: 6px solid #ff7a00; }
        .btn-portal { background-color: #ff7a00; transition: all 0.2s; }
        .btn-portal:hover { background-color: #e66e00; transform: translateY(-2px); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .table-header { background-color: #002d5b; color: white; border-radius: 20px 20px 0 0; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyAiwLcVI-EMmP9nRIpA6IXgPICbHyrXwVE",
            authDomain: "rmt-digital-8df83.firebaseapp.com",
            projectId: "rmt-digital-8df83",
            storageBucket: "rmt-digital-8df83.firebasestorage.app",
            messagingSenderId: "161720627010",
            appId: "1:161720627010:web:84b4da0da31ea8ca8ca2db"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const App = () => {
            const [searchTerm, setSearchTerm] = useState('');
            const [activeClass, setActiveClass] = useState('PPKI');
            const [presentToday, setPresentToday] = useState([]);
            const [currentTime, setCurrentTime] = useState(new Date());
            const [view, setView] = useState('attendance'); // 'attendance' or 'summary'

            // Data logic
            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 1000);
                const today = new Date().toISOString().split('T')[0];
                const unsub = db.collection('daily_attendance').doc(today)
                    .onSnapshot(doc => {
                        if (doc.exists) setPresentToday(doc.data().students || []);
                        else setPresentToday([]);
                    });
                return () => { clearInterval(timer); unsub(); };
            }, []);

            const students = useMemo(() => [
                { id: 1, name: "KHADEEJA AFEEYA BINTI ISMAIL", class: "PPKI" },
                { id: 2, name: "MUHAMMAD AMMAR FARISH BIN MOHD EMRY", class: "PPKI" },
                { id: 3, name: "WAN SHAFIY BENJAMIN BIN WAN MOHD HAFIZULLAH", class: "PPKI" },
                { id: 4, name: "AHMAD ZIYAD AMZAR BIN ZAMRI", class: "PPKI" },
                { id: 5, name: "CHE NOR ASHIF BIN CHE MAT SOKRI", class: "PPKI" },
                { id: 6, name: "ISKANDAR ZAMAKHSHARY BIN ISKANDAR ZULKARNAIN", class: "PPKI" },
                { id: 7, name: "MUHAMMAD ADAM TAUFIQILLAH BIN MOHD FAIZAL", class: "PPKI" },
                { id: 8, name: "MUHAMMAD AQEEL NAUFAL BIN MOHD AZELAN", class: "PPKI" },
                { id: 9, name: "MUHAMMAD FIRAS DANISH BIN ABDUL HALIM", class: "PPKI" },
                { id: 10, name: "MUHAMMAD IFFAT NAFIS BIN MOHD IKHWAN NAIM", class: "PPKI" },
                { id: 11, name: "NUR ADZRAA QAIREENA BINTI AHMAD ZAKRI", class: "PPKI" },
                { id: 12, name: "UFAIRA NUR AFIFA BINTI MOHD HAFIZAN", class: "PPKI" },
                { id: 13, name: "ARWA BINTI ABDUL WAHAB", class: "PPKI" },
                { id: 14, name: "MUHAMAD RAZIQ BIN SOBRI SALAEH", class: "PPKI" },
                { id: 15, name: "MUHAMMAD AQIL ZIQRI BIN JUNAIDI", class: "PPKI" },
                { id: 16, name: "NUR ASMA IMANI BINTI ABDULLAH", class: "PPKI" },
                { id: 17, name: "NUR HAZIRAHUDA BINTI GHAZALI", class: "PPKI" },
                { id: 18, name: "NUR IMAN BINTI AHMAD ZAMURI", class: "PPKI" },
                { id: 19, name: "ADNIN AMIRAH IRDINA BINTI ZAMRI", class: "PPKI" },
                { id: 20, name: "CHE NUR ARISSA ZAHRA BINTI CHE MAT SOKRI", class: "PPKI" },
                { id: 21, name: "MUHAMMAD ADAM BIN ABDUL JALIL", class: "PPKI" },
                { id: 22, name: "MUHAMMAD AIMAN BIN ABDUL JALIL", class: "PPKI" },
                { id: 23, name: "MUHAMMAD HADIF BIN MAHADZIR", class: "PPKI" },
                { id: 24, name: "NUR FAIHA BINTI ABDULLAH", class: "PPKI" },
                { id: 25, name: "NUR SYAZA ADRIANA BINTI SHAHIRAN", class: "PPKI" }
                // ... logic continues for all 219 students
            ], []);

            const classes = ['PPKI', '1 AFQ', '1 AFT', '1 ANR', '1 ARR', '2 AFQ', '2 AFT', '2 ANR', '2 ARR', '3 AFQ', '3 AFT', '3 ANR', '3 ARR', '4 AFQ', '4 AFT', '4 ANR', '4 ARR', '5 AFQ', '5 AFT', '5 ANR', '5 ARR', '6 AFQ', '6 AFT', '6 ANR', '6 ARR'];

            const toggle = async (id) => {
                const today = new Date().toISOString().split('T')[0];
                const docRef = db.collection('daily_attendance').doc(today);
                await docRef.set({
                    students: presentToday.includes(id) 
                        ? firebase.firestore.FieldValue.arrayRemove(id)
                        : firebase.firestore.FieldValue.arrayUnion(id)
                }, { merge: true });
            };

            const stats = {
                present: presentToday.length,
                total: students.length,
                percent: ((presentToday.length / students.length) * 100).toFixed(1)
            };

            return (
                <div className="min-h-screen pb-20">
                    {/* TOP HEADER */}
                    <header className="canvas-header text-white p-6 shadow-2xl">
                        <div className="max-w-6xl mx-auto">
                            <div className="flex flex-col md:flex-row justify-between items-center gap-6">
                                <div className="flex items-center gap-4">
                                    <div className="bg-white p-3 rounded-2xl shadow-lg">
                                        <span className="text-3xl">ü•£</span>
                                    </div>
                                    <div>
                                        <h1 className="text-2xl font-black tracking-tight leading-none uppercase">Pengurusan RMT SKKN</h1>
                                        <div className="flex items-center gap-2 mt-2">
                                            <span className="text-[10px] font-bold text-orange-400 uppercase tracking-widest">Digital System 2026</span>
                                            <span className="bg-green-500/20 text-green-400 text-[9px] px-2 py-0.5 rounded-full font-bold border border-green-500/30">‚óè ONLINE</span>
                                        </div>
                                    </div>
                                </div>

                                <div className="text-center md:text-right hidden md:block">
                                    <p className="text-xs font-bold opacity-60 uppercase tracking-widest mb-1">Masa & Tarikh Semasa</p>
                                    <p className="text-xl font-black tracking-tighter">
                                        {currentTime.toLocaleTimeString('en-GB')} | {currentTime.toLocaleDateString('en-MY', { day: 'numeric', month: 'long', year: 'numeric' })}
                                    </p>
                                </div>

                                <div className="flex items-center gap-6">
                                    <div className="text-right">
                                        <p className="text-[10px] font-bold opacity-60 uppercase">Jumlah Murid</p>
                                        <p className="text-3xl font-black">{stats.total}</p>
                                    </div>
                                    <a href="https://appsjohor.moe.gov.my/rmt/" target="_blank" className="btn-portal px-6 py-3 rounded-xl font-black text-xs flex items-center gap-2 shadow-lg">
                                        <span>üåê</span> PORTAL E-RMT
                                    </a>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto px-4 -mt-10">
                        {/* STATS ROW */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div className="stat-card card-accent-blue p-8 flex justify-between items-center">
                                <div>
                                    <p className="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Hadir Hari Ini</p>
                                    <p className="text-5xl font-black text-[#002d5b]">{stats.present}</p>
                                </div>
                                <div className="bg-blue-50 p-4 rounded-2xl text-blue-500 text-3xl">üë•</div>
                            </div>
                            <div className="stat-card card-accent-orange p-8 flex justify-between items-center">
                                <div>
                                    <p className="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-1">Peratus Kehadiran</p>
                                    <p className="text-5xl font-black text-[#ff7a00]">{stats.percent}%</p>
                                </div>
                                <div className="bg-orange-50 p-4 rounded-2xl text-orange-500 text-3xl">%</div>
                            </div>
                            <div className="bg-gray-200/50 backdrop-blur rounded-[32px] p-2 flex gap-2">
                                <button onClick={() => setView('attendance')} className={`flex-1 py-4 rounded-[24px] font-black text-xs transition-all ${view === 'attendance' ? 'bg-[#002d5b] text-white shadow-xl' : 'text-gray-500'}`}>TANDA KEHADIRAN</button>
                                <button onClick={() => setView('summary')} className={`flex-1 py-4 rounded-[24px] font-black text-xs transition-all ${view === 'summary' ? 'bg-[#002d5b] text-white shadow-xl' : 'text-gray-500'}`}>RUMUSAN BULANAN</button>
                            </div>
                        </div>

                        {view === 'attendance' ? (
                            <div className="animate-fadeIn">
                                <div className="bg-white p-6 rounded-[32px] shadow-sm border border-gray-100 mb-8">
                                    <input type="text" placeholder="Cari nama murid..." className="w-full p-5 bg-gray-50 rounded-2xl border-none focus:ring-2 focus:ring-[#002d5b] outline-none font-bold text-gray-700 mb-6" onChange={(e) => setSearchTerm(e.target.value)} />
                                    <div className="flex overflow-x-auto gap-2 no-scrollbar pb-2">
                                        {classes.map(c => (
                                            <button key={c} onClick={() => setActiveClass(c)} className={`px-8 py-3 rounded-xl whitespace-nowrap text-[10px] font-black transition-all ${activeClass === c ? 'bg-[#ff7a00] text-white shadow-lg' : 'bg-gray-100 text-gray-400'}`}>{c}</button>
                                        ))}
                                    </div>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {students.filter(s => s.class === activeClass && s.name.toLowerCase().includes(searchTerm.toLowerCase())).map(s => (
                                        <div key={s.id} className="bg-white p-5 rounded-3xl shadow-sm border border-gray-50 flex justify-between items-center">
                                            <div className="flex
