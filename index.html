<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PENGURUSAN RMT SKIOR 2026</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; }
        .canvas-header { background-color: #002d5b; border-bottom: 5px solid #ff7a00; }
        .btn-portal { background-color: #ff7a00; color: white; font-weight: 800; transition: 0.2s; }
        .btn-portal:hover { background-color: #e66e00; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // 1. FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyAiwLcVI-EMmP9nRIpA6IXgPICbHyrXwVE",
            authDomain: "rmt-digital-8df83.firebaseapp.com",
            projectId: "rmt-digital-8df83",
            storageBucket: "rmt-digital-8df83.firebasestorage.app",
            messagingSenderId: "161720627010",
            appId: "1:161720627010:web:84b4da0da31ea8ca8ca2db"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const App = () => {
            const [view, setView] = useState('attendance');
            const [activeClass, setActiveClass] = useState('PPKI');
            const [presentToday, setPresentToday] = useState([]);
            const [time, setTime] = useState(new Date());

            // 2. DATA
            const classes = ['PPKI', '1 AFQ', '1 AFT', '1 ANR', '1 ARR', '2 AFQ', '2 AFT', '2 ANR', '2 ARR', '3 AFQ', '3 AFT', '3 ANR', '3 ARR', '4 AFQ', '4 AFT', '4 ANR', '4 ARR', '5 AFQ', '5 AFT', '5 ANR', '5 ARR', '6 AFQ', '6 AFT', '6 ANR', '6 ARR'];
            
            // Add your full list of students here
            const students = [
                { id: 1, name: "KHADEEJA AFEEYA", class: "PPKI" },
                { id: 2, name: "MUHAMMAD AMMAR FARISH", class: "PPKI" },
                { id: 3, name: "WAN SHAFIY BENJAMIN", class: "PPKI" },
                { id: 26, name: "AHMAD SYAQIL HAIDAR", class: "1 AFQ" },
                { id: 27, name: "AHMAD SYARIF", class: "1 AFQ" }
                // ... (add others here)
            ];

            // 3. EFFECTS (Sync with Firebase)
            useEffect(() => {
                const timer = setInterval(() => setTime(new Date()), 1000);
                const today = new Date().toISOString().split('T')[0];
                
                const unsub = db.collection('daily_attendance').doc(today)
                    .onSnapshot(doc => {
                        if (doc.exists) setPresentToday(doc.data().students || []);
                    });
                return () => { clearInterval(timer); unsub(); };
            }, []);

            const toggleAttendance = async (id) => {
                const today = new Date().toISOString().split('T')[0];
                const docRef = db.collection('daily_attendance').doc(today);
                const isPresent = presentToday.includes(id);
                
                await docRef.set({
                    students: isPresent 
                        ? firebase.firestore.FieldValue.arrayRemove(id)
                        : firebase.firestore.FieldValue.arrayUnion(id)
                }, { merge: true });
            };

            const filteredStudents = useMemo(() => 
                students.filter(s => s.class === activeClass), 
            [activeClass]);

            return (
                <div className="min-h-screen">
                    <header className="canvas-header text-white p-6 shadow-xl">
                        <div className="max-w-6xl mx-auto flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="flex items-center gap-3">
                                <div className="bg-white p-2 rounded-xl text-2xl">ü•£</div>
                                <div>
                                    <h1 className="text-xl font-extrabold uppercase tracking-tight">PENGURUSAN RMT SKKN</h1>
                                    <p className="text-[10px] font-bold text-orange-400 uppercase tracking-widest">Sistem Digital 2026</p>
                                </div>
                            </div>
                            <div className="text-center font-bold">
                                <p className="text-[10px] opacity-60 uppercase">Masa & Tarikh</p>
                                <p className="text-lg tabular-nums">{time.toLocaleTimeString('en-GB')} | {time.toLocaleDateString('en-MY')}</p>
                            </div>
                            <a href="https://appsjohor.moe.gov.my/rmt/" target="_blank" className="btn-portal px-6 py-3 rounded-xl text-xs shadow-lg">
                                üåê PORTAL E-RMT
                            </a>
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto px-4 mt-8">
                        {/* Stats Dashboard */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                            <div className="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-blue-600 flex justify-between items-center">
                                <div><p className="text-[10px] font-bold text-gray-400 uppercase">Hadir Hari Ini</p><p className="text-4xl font-black text-[#002d5b]">{presentToday.length}</p></div>
                                <div className="text-3xl opacity-20">üë•</div>
                            </div>
                            <div className="bg-white p-6 rounded-2xl shadow-sm border-l-4 border-orange-500 flex justify-between items-center">
                                <div><p className="text-[10px] font-bold text-gray-400 uppercase">Peratus</p><p className="text-4xl font-black text-orange-500">{((presentToday.length/219)*100).toFixed(1)}%</p></div>
                                <div className="text-3xl opacity-20">%</div>
                            </div>
                            <div className="bg-gray-200/50 p-1 rounded-2xl flex">
                                <button onClick={() => setView('attendance')} className={`flex-1 py-3 rounded-xl font-bold text-[10px] ${view==='attendance'?'bg-[#002d5b] text-white':'text-gray-500'}`}>TANDA KEHADIRAN</button>
                                <button onClick={() => setView('summary')} className={`flex-1 py-3 rounded-xl font-bold text-[10px] ${view==='summary'?'bg-[#002d5b] text-white':'text-gray-500'}`}>RUMUSAN</button>
                            </div>
                        </div>

                        {view === 'attendance' ? (
                            <div>
                                {/* Class Filter */}
                                <div className="flex overflow-x-auto gap-2 no-scrollbar mb-6 pb-2">
                                    {classes.map(c => (
                                        <button key={c} onClick={() => setActiveClass(c)} className={`px-5 py-2 rounded-xl whitespace-nowrap text-[10px] font-bold transition-all ${activeClass === c ? 'bg-blue-600 text-white shadow-lg scale-105' : 'bg-white text-gray-400 border border-gray-100 hover:bg-gray-50'}`}>{c}</button>
                                    ))}
                                </div>

                                {/* Student Cards */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 mb-10">
                                    {filteredStudents.map((s, idx) => {
                                        const isPresent = presentToday.includes(s.id);
                                        return (
                                            <div key={s.id} onClick={() => toggleAttendance(s.id)} 
                                                className={`p-4 rounded-2xl cursor-pointer transition-all border-2 flex items-center justify-between ${isPresent ? 'bg-blue-50 border-blue-500 shadow-md' : 'bg-white border-transparent shadow-sm hover:border-gray-200'}`}>
                                                <div className="flex items-center gap-3">
                                                    <span className="text-[10px] font-bold text-gray-300 w-4">{idx + 1}</span>
                                                    <p className={`text-xs font-extrabold uppercase ${isPresent ? 'text-blue-900' : 'text-gray-700'}`}>{s.name}</p>
                                                </div>
                                                <div className={`w-6 h-6 rounded-full flex items-center justify-center ${isPresent ? 'bg-blue-600 text-white' : 'bg-gray-100'}`}>
                                                    {isPresent && '‚úì'}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        ) : (
                            <div className="bg-white rounded-3xl p-20 text-center border-2 border-dashed border-gray-200">
                                <p className="font-bold text-gray-400">Papar rumusan bulanan di sini.</p>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
